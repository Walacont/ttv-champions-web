<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <title>SC Champions - Supabase Test</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            body { font-family: 'Inter', sans-serif; }
        </style>
    </head>
    <body class="bg-gray-100 min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-center mb-8">Supabase Test Page</h1>

            <!-- Status Card -->
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Connection Status</h2>
                <div id="status" class="text-gray-600">Checking...</div>
            </div>

            <!-- Auth Test Card -->
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Auth Test</h2>
                <div id="auth-status" class="mb-4 text-gray-600">Not logged in</div>

                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input
                            type="email"
                            id="email"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="test@example.com"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input
                            type="password"
                            id="password"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="********"
                        />
                    </div>
                    <div class="flex space-x-2">
                        <button
                            type="submit"
                            class="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700"
                        >
                            Login
                        </button>
                        <button
                            type="button"
                            id="signup-btn"
                            class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700"
                        >
                            Sign Up
                        </button>
                    </div>
                </form>

                <button
                    id="logout-btn"
                    class="w-full mt-4 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 hidden"
                >
                    Logout
                </button>

                <div id="auth-message" class="mt-4 text-sm"></div>
            </div>

            <!-- Database Test Card -->
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Database Test</h2>

                <button
                    id="test-sports"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 mb-2"
                >
                    Load Sports
                </button>

                <button
                    id="test-clubs"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 mb-2"
                >
                    Load Clubs
                </button>

                <button
                    id="test-profile"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 mb-2"
                >
                    Load My Profile
                </button>

                <div id="db-result" class="mt-4 p-4 bg-gray-100 rounded-md text-sm overflow-auto max-h-64">
                    <pre>Click a button to test...</pre>
                </div>
            </div>

            <!-- Console Log -->
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Console Log</h2>
                <div id="console-log" class="bg-gray-900 text-green-400 p-4 rounded-md text-xs font-mono overflow-auto max-h-64">
                </div>
            </div>
        </div>

        <script type="module">
            import {
                initSupabase,
                getSupabase,
                signIn,
                signUp,
                signOut,
                getCurrentUser,
                onAuthStateChange,
                getSports,
                getClubs,
                getUserProfile
            } from './js/supabase-init.js';

            // Custom console logger
            const consoleLog = document.getElementById('console-log');
            function log(message, type = 'info') {
                const colors = {
                    info: 'text-green-400',
                    error: 'text-red-400',
                    warn: 'text-yellow-400'
                };
                const time = new Date().toLocaleTimeString();
                consoleLog.innerHTML += `<div class="${colors[type]}">[${time}] ${message}</div>`;
                consoleLog.scrollTop = consoleLog.scrollHeight;
                console.log(`[${type.toUpperCase()}]`, message);
            }

            // Initialize
            log('Initializing Supabase...');
            const supabase = initSupabase();
            log('Supabase client created');

            // Check connection
            const statusEl = document.getElementById('status');
            try {
                const { data, error } = await supabase.from('sports').select('count');
                if (error) throw error;
                statusEl.innerHTML = '<span class="text-green-600 font-semibold">Connected to Supabase!</span>';
                log('Connection successful!');
            } catch (error) {
                statusEl.innerHTML = `<span class="text-red-600 font-semibold">Connection failed: ${error.message}</span>`;
                log(`Connection failed: ${error.message}`, 'error');
            }

            // Auth state
            const authStatus = document.getElementById('auth-status');
            const authMessage = document.getElementById('auth-message');
            const loginForm = document.getElementById('login-form');
            const logoutBtn = document.getElementById('logout-btn');

            onAuthStateChange((event, session) => {
                log(`Auth event: ${event}`);
                if (session?.user) {
                    authStatus.innerHTML = `<span class="text-green-600">Logged in as: ${session.user.email}</span>`;
                    loginForm.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                } else {
                    authStatus.innerHTML = '<span class="text-gray-600">Not logged in</span>';
                    loginForm.classList.remove('hidden');
                    logoutBtn.classList.add('hidden');
                }
            });

            // Login
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                log(`Attempting login: ${email}`);
                authMessage.innerHTML = '<span class="text-gray-600">Logging in...</span>';

                try {
                    const data = await signIn(email, password);
                    log(`Login successful: ${data.user.email}`);
                    authMessage.innerHTML = '<span class="text-green-600">Login successful!</span>';
                } catch (error) {
                    log(`Login failed: ${error.message}`, 'error');
                    authMessage.innerHTML = `<span class="text-red-600">Error: ${error.message}</span>`;
                }
            });

            // Sign Up
            document.getElementById('signup-btn').addEventListener('click', async () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                log(`Attempting signup: ${email}`);
                authMessage.innerHTML = '<span class="text-gray-600">Signing up...</span>';

                try {
                    const data = await signUp(email, password, 'Test User');
                    log(`Signup successful: ${data.user?.email || 'check email'}`);
                    authMessage.innerHTML = '<span class="text-green-600">Check your email to confirm!</span>';
                } catch (error) {
                    log(`Signup failed: ${error.message}`, 'error');
                    authMessage.innerHTML = `<span class="text-red-600">Error: ${error.message}</span>`;
                }
            });

            // Logout
            logoutBtn.addEventListener('click', async () => {
                log('Logging out...');
                try {
                    await signOut();
                    log('Logged out successfully');
                } catch (error) {
                    log(`Logout failed: ${error.message}`, 'error');
                }
            });

            // Database tests
            const dbResult = document.getElementById('db-result');

            document.getElementById('test-sports').addEventListener('click', async () => {
                log('Loading sports...');
                try {
                    const sports = await getSports();
                    log(`Loaded ${sports.length} sports`);
                    dbResult.innerHTML = `<pre>${JSON.stringify(sports, null, 2)}</pre>`;
                } catch (error) {
                    log(`Error: ${error.message}`, 'error');
                    dbResult.innerHTML = `<pre class="text-red-600">Error: ${error.message}</pre>`;
                }
            });

            document.getElementById('test-clubs').addEventListener('click', async () => {
                log('Loading clubs...');
                try {
                    const clubs = await getClubs();
                    log(`Loaded ${clubs.length} clubs`);
                    dbResult.innerHTML = `<pre>${JSON.stringify(clubs, null, 2)}</pre>`;
                } catch (error) {
                    log(`Error: ${error.message}`, 'error');
                    dbResult.innerHTML = `<pre class="text-red-600">Error: ${error.message}</pre>`;
                }
            });

            document.getElementById('test-profile').addEventListener('click', async () => {
                log('Loading profile...');
                try {
                    const user = await getCurrentUser();
                    if (!user) {
                        dbResult.innerHTML = '<pre class="text-yellow-600">Not logged in</pre>';
                        log('Not logged in', 'warn');
                        return;
                    }
                    const profile = await getUserProfile(user.id);
                    log('Profile loaded');
                    dbResult.innerHTML = `<pre>${JSON.stringify(profile, null, 2)}</pre>`;
                } catch (error) {
                    log(`Error: ${error.message}`, 'error');
                    dbResult.innerHTML = `<pre class="text-red-600">Error: ${error.message}</pre>`;
                }
            });

            log('Test page ready!');
        </script>
    </body>
</html>
