/**
 * Mobile App Fixes for Capacitor
 * Fixes touch scrolling, click issues, and status bar overlap
 * These styles only apply to Capacitor native apps (plt-capacitor, plt-android)
 */

/* Enable smooth scrolling on iOS */
html, body {
    -webkit-overflow-scrolling: touch;
}

/* Fix for touch events */
* {
    -webkit-tap-highlight-color: transparent;
}

/* Ensure buttons and links are clickable */
button, a, input, select, textarea, [onclick], [role="button"] {
    touch-action: manipulation;
    cursor: pointer;
}

/* Fix scrollable containers */
.overflow-y-auto,
.overflow-auto,
[style*="overflow"] {
    -webkit-overflow-scrolling: touch;
}

/* ============================================
   CAPACITOR/MOBILE ONLY STYLES
   These only apply when running as native app
   ============================================ */

/* Safe area padding for Capacitor native apps only */
html.plt-capacitor body,
html.plt-android body {
    padding-top: 0 !important;
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}

/* Header gets padding inside to push content below status bar, but stays at top:0 */
/* Use safe-area-inset-top with a fallback of 44px for devices that don't report it correctly */
html.plt-capacitor header.sticky,
html.plt-android header.sticky,
html.plt-ios header.sticky,
html.plt-capacitor .sticky.top-0,
html.plt-android .sticky.top-0,
html.plt-ios .sticky.top-0 {
    top: 0 !important;
    padding-top: max(env(safe-area-inset-top, 44px), 44px) !important;
}

/* Non-sticky headers just need padding */
html.plt-capacitor header:not(.sticky),
html.plt-android header:not(.sticky),
html.plt-ios header:not(.sticky) {
    padding-top: max(env(safe-area-inset-top, 44px), 44px) !important;
}

/* ============================================
   DASHBOARD FIXED NAVIGATION - SAFE AREA
   The dashboard uses #top-nav with fixed positioning
   ============================================ */

/* Top Navigation Bar - add padding for status bar */
html.plt-capacitor #top-nav,
html.plt-android #top-nav,
html.plt-ios #top-nav {
    padding-top: max(env(safe-area-inset-top, 28px), 28px) !important;
}

/* Main content needs extra padding to account for taller header */
html.plt-capacitor #main-content,
html.plt-android #main-content,
html.plt-ios #main-content {
    padding-top: calc(56px + max(env(safe-area-inset-top, 28px), 28px)) !important;
}

/* Community fullscreen overlay - also needs safe area */
html.plt-capacitor #community-fullscreen > .sticky,
html.plt-android #community-fullscreen > .sticky,
html.plt-ios #community-fullscreen > .sticky {
    padding-top: max(env(safe-area-inset-top, 28px), 28px) !important;
}

/* Make sure touch events work */
html.plt-capacitor header *,
html.plt-android header *,
html.plt-ios header * {
    pointer-events: auto !important;
}

/* Fix modal overlays in Capacitor */
html.plt-capacitor .fixed.inset-0,
html.plt-android .fixed.inset-0,
html.plt-ios .fixed.inset-0 {
    padding-top: max(env(safe-area-inset-top, 44px), 44px);
}

/* ============================================
   NOTIFICATION MODAL FIX
   Modal needs to be pushed down more to clear header on Android
   ============================================ */
html.plt-capacitor #notification-modal,
html.plt-android #notification-modal,
html.plt-ios #notification-modal {
    padding-top: calc(max(env(safe-area-inset-top, 44px), 44px) + 56px) !important;
}

/* ============================================
   COACH DASHBOARD TOP SPACING FIX
   Reduce top padding on mobile native apps
   ============================================ */
html.plt-capacitor .coach-dashboard-content,
html.plt-android .coach-dashboard-content,
html.plt-ios .coach-dashboard-content {
    padding-top: 0 !important;
}

html.plt-capacitor .coach-dashboard-content > header,
html.plt-android .coach-dashboard-content > header,
html.plt-ios .coach-dashboard-content > header {
    margin-bottom: 0.5rem !important;
}

/* ============================================
   PROFILE PAGE TOP SPACING FIX
   Reduce top padding on mobile native apps
   ============================================ */
html.plt-capacitor .profile-content-wrapper,
html.plt-android .profile-content-wrapper,
html.plt-ios .profile-content-wrapper {
    padding-top: 0.5rem !important;
}

/* ============================================
   EXPORT BUTTONS - SMALLER ON MOBILE
   ============================================ */
@media (max-width: 640px) {
    .export-btn-mobile {
        padding: 0.375rem 0.75rem !important;
        font-size: 0.75rem !important;
    }

    .export-btn-mobile span {
        display: none;
    }

    .export-btn-mobile i {
        margin-right: 0 !important;
    }
}

/* ============================================
   DOUBLES MATCH CARD - MOBILE TEXT OVERFLOW
   ============================================ */
@media (max-width: 480px) {
    /* Truncate long player names in doubles cards */
    .doubles-match-card .team-names,
    .doubles-team-names {
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Stack teams vertically on very small screens */
    .doubles-teams-row {
        flex-direction: column !important;
        gap: 0.5rem !important;
    }

    .doubles-teams-row .vs-separator {
        display: none !important;
    }

    /* Show "vs" between stacked teams */
    .doubles-teams-row::after {
        content: 'vs';
        display: block;
        text-align: center;
        color: #9ca3af;
        font-size: 0.75rem;
        order: 1;
    }

    .doubles-teams-row > div:first-child {
        order: 0;
    }

    .doubles-teams-row > div:last-child {
        order: 2;
    }
}

/* ============================================
   GENERAL MOBILE STYLES (Web + Native)
   ============================================ */

/* Prevent text selection on buttons */
button {
    -webkit-user-select: none;
    user-select: none;
}

/* Fix for keyboard showing (Capacitor only) */
html.plt-capacitor .keyboard-visible,
html.plt-android .keyboard-visible,
html.plt-ios .keyboard-visible {
    height: calc(100% - var(--keyboard-height, 0px));
}

/* Ensure main content is scrollable */
main,
section,
.container,
.min-h-screen {
    touch-action: pan-y;
    -webkit-overflow-scrolling: touch;
}

/* Profile page scroll fix */
body {
    overflow-y: auto !important;
}

/* Ensure page content can scroll after SPA navigation */
html:not(.modal-open) body,
html body:not([style*="overflow: hidden"]) {
    overflow-y: auto;
}

/* ============================================
   MODAL FIXES FOR SMALL SCREENS
   ============================================ */

/* Fix login modal on small screens - make it scrollable and align to top */
#login-modal {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

@media (max-height: 700px) {
    #login-modal {
        align-items: flex-start !important;
        padding-top: 20px !important;
        padding-bottom: 20px !important;
    }

    #login-modal > div {
        margin-top: 0;
        margin-bottom: auto;
    }
}

/* Ensure modal content doesn't exceed viewport */
#login-modal > div {
    max-height: calc(100vh - 40px);
    overflow-y: auto;
}
