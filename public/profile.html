<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <script src="/js/capacitor-init.js"></script>
        <title>Profil - SC Champions</title>

        <!-- Favicon -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

        <!-- PWA Meta Tags -->
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" content="#1e3a5f" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="SC Champions" />
        <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
        <meta name="mobile-web-app-capable" content="yes" />

        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="stylesheet" href="/css/spa-enhancements.css" />
        <link rel="stylesheet" href="/css/mobile-fixes.css" />
        <style>
            body {
                font-family: 'Inter', sans-serif;
            }
            #page-loader {
                display: flex;
                justify-content: center;
                align-items: center;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: #f3f4f6;
                z-index: 9999;
            }
            #main-content {
                display: none;
            }
            .stat-card {
                transition: transform 0.2s;
            }
            .stat-card:hover {
                transform: translateY(-2px);
            }
            /* Ensure scrolling works */
            html, body {
                overflow-y: auto;
                min-height: 100%;
            }
            #main-content {
                overflow-y: auto;
                padding-bottom: env(safe-area-inset-bottom, 20px);
            }
        </style>
    </head>
    <body class="bg-gray-100 text-gray-800">
        <div id="page-loader">
            <svg
                class="animate-spin h-10 w-10 text-indigo-600"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
            >
                <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                ></circle>
                <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
            </svg>
        </div>

        <div id="main-content" class="min-h-screen">
            <!-- Top Navigation Bar -->
            <div class="bg-white border-b border-gray-200 sticky top-0 z-10">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <button
                            onclick="window.location.href = document.referrer.includes('dashboard') ? document.referrer : '/dashboard.html#community'"
                            class="text-gray-600 hover:text-gray-800 transition flex items-center"
                        >
                            <i class="fas fa-arrow-left text-lg mr-2"></i>
                            <span class="text-sm font-medium" data-i18n="profile.back">Zurück</span>
                        </button>
                        <h1 class="text-lg font-semibold text-gray-800" data-i18n="profile.title">Profil</h1>
                        <button
                            id="profile-menu-btn"
                            class="text-gray-600 hover:text-gray-800 transition"
                        >
                            <i class="fas fa-ellipsis-h text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="container mx-auto px-4 py-6">
                <!-- Avatar -->
                <div class="flex justify-center mb-4">
                    <img
                        id="profile-avatar"
                        src="https://placehold.co/120x120/e2e8f0/64748b?text=..."
                        alt="Profilbild"
                        class="h-24 w-24 rounded-full object-cover border-4 border-white shadow-lg bg-white"
                    />
                </div>

                <div class="bg-white rounded-2xl shadow-md overflow-hidden">
                    <!-- Profile Info Section -->
                    <div class="p-6">
                        <!-- Name and Location -->
                        <div class="text-center">
                            <h1 id="profile-name" class="text-2xl font-bold text-gray-900" data-i18n="profile.loading">
                                Laden...
                            </h1>
                            <p id="profile-subtitle" class="text-gray-600 font-medium hidden"></p>
                            <p id="profile-location" class="text-gray-500 mt-1">
                                <i class="fas fa-map-marker-alt mr-1"></i>
                                <span>-</span>
                            </p>
                        </div>

                        <!-- Bio -->
                        <div id="profile-bio-container" class="mt-3 hidden">
                            <p id="profile-bio" class="text-gray-600 text-center text-sm">
                            </p>
                        </div>

                        <!-- Edit Profile Button (own profile only) -->
                        <div id="edit-profile-btn-container" class="mt-4 flex justify-center hidden">
                            <!-- Dynamically filled for own profile -->
                        </div>

                        <!-- Follow Button -->
                        <div id="follow-button-container" class="mt-4 flex justify-center">
                            <!-- Button wird dynamisch eingefügt -->
                        </div>

                        <!-- Follower Stats -->
                        <div class="flex justify-center gap-8 mt-4 pt-4 border-t">
                            <a id="following-link" href="#" class="text-center hover:bg-gray-50 px-4 py-2 rounded-lg transition cursor-pointer">
                                <span id="following-count" class="text-xl font-bold text-gray-900">0</span>
                                <p class="text-sm text-gray-500" data-i18n="profile.following">Gefolgt</p>
                            </a>
                            <a id="followers-link" href="#" class="text-center hover:bg-gray-50 px-4 py-2 rounded-lg transition cursor-pointer">
                                <span id="followers-count" class="text-xl font-bold text-gray-900">0</span>
                                <p class="text-sm text-gray-500" data-i18n="profile.followers">Abonnenten</p>
                            </a>
                        </div>
                    </div>

                    <!-- Private Profile Notice -->
                    <div id="private-profile-notice" class="hidden bg-gray-50 p-6 border-t">
                        <div class="text-center">
                            <i class="fas fa-lock text-4xl text-gray-400 mb-3"></i>
                            <h3 class="text-lg font-semibold text-gray-700" data-i18n="profile.privateProfile.title">Dieses Profil ist privat</h3>
                            <p class="text-gray-500 mt-1" data-i18n="profile.privateProfile.description">Folge dieser Person, um Aktivitäten, Erfolge und mehr zu sehen</p>
                        </div>
                    </div>

                    <!-- Public Profile Content -->
                    <div id="public-profile-content" class="hidden">
                        <!-- Strava-style Tab Switcher (only for own profile) -->
                        <div id="profile-tab-switcher" class="hidden border-t">
                            <div class="flex">
                                <button
                                    id="profile-tab-aktivitaet"
                                    class="profile-tab-btn flex-1 py-3 text-center font-semibold text-sm border-b-2 border-indigo-600 text-indigo-600 transition"
                                    onclick="switchProfileTab('aktivitaet')"
                                >
                                    <i class="fas fa-running mr-1"></i><span data-i18n="profile.tabs.activity">Aktivität</span>
                                </button>
                                <button
                                    id="profile-tab-fortschritt"
                                    class="profile-tab-btn flex-1 py-3 text-center font-semibold text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition"
                                    onclick="switchProfileTab('fortschritt')"
                                >
                                    <i class="fas fa-chart-line mr-1"></i><span data-i18n="profile.tabs.progress">Fortschritt</span>
                                </button>
                            </div>
                        </div>

                        <!-- Aktivität Tab Content (what others see) -->
                        <div id="profile-content-aktivitaet">
                            <!-- Stats Grid -->
                            <div class="p-6 border-t">
                                <div class="grid grid-cols-4 gap-2 text-center">
                                    <div class="stat-card p-3">
                                        <p id="stat-elo" class="text-xl font-bold text-gray-900">-</p>
                                        <p class="text-xs text-gray-500" data-i18n="profile.statLabels.elo">Elo</p>
                                    </div>
                                    <div class="stat-card p-3">
                                        <p id="stat-wins" class="text-xl font-bold text-gray-900">-</p>
                                        <p class="text-xs text-gray-500" data-i18n="profile.statLabels.wins">Siege</p>
                                    </div>
                                    <div class="stat-card p-3">
                                        <p id="stat-matches" class="text-xl font-bold text-gray-900">-</p>
                                        <p class="text-xs text-gray-500" data-i18n="profile.statLabels.matches">Spiele</p>
                                    </div>
                                    <div class="stat-card p-3">
                                        <p id="stat-points" class="text-xl font-bold text-gray-900">-</p>
                                        <p class="text-xs text-gray-500" data-i18n="profile.statLabels.points">Punkte</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Club Section -->
                            <div id="club-section" class="p-6 border-t hidden">
                                <div id="club-info" class="flex items-center gap-3">
                                    <div class="h-10 w-10 bg-gray-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-building text-gray-500"></i>
                                    </div>
                                    <div>
                                        <p id="club-name" class="font-medium text-gray-800">-</p>
                                        <p id="club-members" class="text-sm text-gray-500">- Mitglieder</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity Preview -->
                            <div id="activity-section" class="p-6 border-t hidden">
                                <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4" data-i18n="profile.recentActivity">
                                    Letzte Aktivität
                                </h2>
                                <div id="recent-matches">
                                    <p class="text-gray-400 text-center py-4 text-sm" data-i18n="profile.noActivities">
                                        Keine Aktivitäten
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Fortschritt Tab Content (private widgets - only for own profile) -->
                        <div id="profile-content-fortschritt" class="hidden">
                            <!-- Content loaded dynamically by JS -->
                        </div>
                    </div>
                </div>

                <!-- Mutual Friends Section -->
                <div id="mutual-friends-section" class="bg-white rounded-2xl shadow-md mt-4 p-6 hidden">
                    <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4" data-i18n="profile.mutualFriends">
                        Gemeinsame Freunde
                    </h2>
                    <div id="mutual-friends-list" class="flex flex-wrap gap-3">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <!-- Own Profile Extras (XP, Challenges, Attendance) - only shown for own profile -->
                <div id="own-profile-extras" class="mt-4 hidden">
                    <!-- Dynamically filled with XP, Rank, Challenges, Attendance -->
                </div>
            </div>

            <!-- Bottom Padding -->
            <div class="h-8"></div>
        </div>

        <!-- Scripts -->
        <script src="/js/update-checker.js"></script>
        <script src="/js/pwa-register.js"></script>
        <script type="module">
            // Initialize i18n
            import { initI18n, translatePage, setupAutoTranslate } from '/js/i18n.js';

            async function initializeI18n() {
                await initI18n();
                setupAutoTranslate();
                translatePage();
                document.documentElement.lang = localStorage.getItem('app_language') || 'de';
            }

            initializeI18n();
        </script>
        <script type="module" src="/js/profile-view-supabase.js"></script>
    </body>
</html>
